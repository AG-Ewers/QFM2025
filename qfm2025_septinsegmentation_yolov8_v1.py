# -*- coding: utf-8 -*-
"""QFM2025_SeptinSegmentation_YOLOv8_v1.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1u9NSQ8ZLVuRdqFx0WSuplIExsC9KyQPX

# **Septin Segmentation** Notebook for QFM2025 Course

This notebook provides a workflow for **segmenting septin rings in microscopy images**. It includes steps for dataset preparation, model training, and prediction using YOLOv8, with customizable options to fine-tune the detection process. Designed specifically for the **QFM2025 course**, it aims to make object detection in pSTORM data.

contact: amin.zehtabian@fu-berlin.de
Last Update: Jan 2025

###GPU Check + Installing necessary libraries

Execute this cell to verify **GPU** access and install some necessary **libraries**.

Note: To use a better GPU, go to the toolbar, select **Runtime**, and switch the Runtime Type to one of the available GPU options
"""

!nvidia-smi
from matplotlib import image
from matplotlib import pyplot as plt
from PIL import Image
#from IPython import display
#display.clear_output()
#from IPython.display import display, Image
import glob
import random
import os
!pip install tqdm   # for progress bar
from tqdm.notebook import tqdm
HOME = os.getcwd();
#display(HOME)

"""Optional: Mount **Google Drive** and get the current working directory."""

from google.colab import drive
drive.mount('/content/drive')

#@markdown ###Path to the project (where the data and final models should be stored):
project_path = '/content/Project_Septin'#@param {type:"string"}

import os
#%cd project_path
!mkdir {project_path}
os.chdir(project_path)
HOME = os.getcwd()

"""# Installing YOLOv8

We are now ready to use the YOLOv8 model for training on our annotated images. **YOLOv8** supports a variety of prediction tasks, including:

- **Detection**: Drawing bounding boxes around objects.
- **Segmentation**: Outlining objects in an image.
- **Tracking**: Following objects across frames in a video.
- **Image Classification**: Categorizing images into predefined classes.
- **Pose Detection**: Estimating keypoints for human or object poses.

For our project, the focus will be on the **Segmentation of Septin Rings** (previously, we addressed detection of rings). You can find examples and additional resources on the Ultralytics GitHub page ((https://github.com/ultralytics/ultralytics))
"""

# Commented out IPython magic to ensure Python compatibility.
# %pip install ultralytics --quiet
import ultralytics
ultralytics.checks()

"""# Run Standard Pre-Trained YOLO Models on the Test Image

- Create a sub-folder named 'test' within your project folder (default: 'Project_Septin/test/').
- Place example test images into this folder.
- This cell runs a standard pre-trained YOLOv8 model on the test images. However, since the model has not been trained on data similar to your septin images, you will observe that no detection or segmentation is performed on these images.
"""

# Commented out IPython magic to ensure Python compatibility.
from ultralytics import YOLO

#%cd {HOME}/test
Test_Image1 = '/content/Project_Septin/test/test.jpg'
#plt.imshow(image.imread(Test_Image1))

# %cd {HOME}
# Standard pre-trained model for detection
model_detection = YOLO('yolov8n.pt')
# Standard pre-trained model for segmentation
model_segmentation = YOLO('yolov8n-seg.pt')

# Run the standard pre-trained models for detection and segmentation
prediction_detection = model_detection.predict(Test_Image1)
prediction_segmentation = model_segmentation.predict(Test_Image1)
# Visualization
detection_result_array = prediction_detection[0].plot()
instance_result_array = prediction_segmentation[0].plot()


fig = plt.figure(figsize=(18, 9))
ax1 = fig.add_subplot(1,3,1)
ax1.set_title("Raw Image")
plt.imshow(image.imread(Test_Image1))
ax2 = fig.add_subplot(1,3,2)
ax2.set_title("Object Detection")
ax2.imshow(detection_result_array)
ax3 = fig.add_subplot(1,3,3)
ax3.set_title("Instance Segmentation")
ax3.imshow(instance_result_array)

"""# Training → Step #1: Importing the Training Dataset from Roboflow

To enable the model to recognize microscopy images containing septin rings, we need to train the model further (also known as **fine-tuning**) using a suitable training dataset. If you don’t have a pre-existing dataset, you will need to create one and annotate the training images.

There are several tools available for annotating objects in images, and the choice of tool depends on the type of annotation required. For example, annotations for object detection differ from those needed for segmentation. One of the simplest and most effective tools for annotation is **Roboflow** (https://roboflow.com/).

To help you get started, I have prepared a PowerPoint file with detailed instructions on creating training samples. Once you have created a custom training dataset using Roboflow, simply copy and paste your **API_KEY** into the code below to integrate it into your project.
"""

# Commented out IPython magic to ensure Python compatibility.
!mkdir {HOME}/datasets
# %cd {HOME}/datasets
!pip install roboflow --quiet

from roboflow import Roboflow
rf = Roboflow(api_key="0o69ClS8r4Cwtju09p6Y")
project = rf.workspace("agewers-30oij").project("test-qe4xb")
version = project.version(1)
dataset = version.download("yolov8")

"""# Training → Step #2: Modifying the data.yaml file

The training dataset has been successfully imported from the Roboflow cloud repository.

**Note 1:**
You can access the training, validation, and test images under the folder '**/datasets/**'. Detailed information about the datasets, such as paths and class labels, can be found in the file **data.yaml**.

**Note 2:**
In some versions of YOLOv8, you might encounter an error indicating that the model cannot locate the training and validation folders. To resolve this issue, open the **data.yaml** file and make a small modification. Update the paths to the following training and validation datasets to ensure they are correctly referenced:

![image.png](data:image/png;base64,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)

# Training → Step #3: Parameter Setting for Training

Here we need to set some training parameters, including the exact **YOLOv8 pre-trained segmentation model** we are going to fune-tune further.

We may begin training with the **YOLOv8s-seg.pt model**, which is the "small" version of YOLOv8 designed for object segmentation. This model provides a balance between speed and accuracy, making it suitable for many applications.

Note:
You are welcome to experiment with other YOLOv8 models based on your requirements:

Less complex models:
- YOLOv8n-seg.pt (nano): Prioritizes speed and efficiency, suitable for resource-constrained environments.

More complex models:
- YOLOv8m-seg.pt (medium): Offers improved accuracy at the cost of slightly higher computational requirements.
- YOLOv8l-seg.pt (large): Focuses on higher accuracy and is suitable for high-powered setups.
- YOLOv8x-seg.pt (extra-large): Provides the best accuracy but requires significant computational resources.

I suggest testing different **training parameters & settings** such as the number of epochs, image size, etc.
"""

#Training_source = base_path + "/data/Stardist/Training - Images" #@param {type:"string"}
#Training_target = base_path + "/data/Stardist/Training - Masks" #@param {type:"string"}

#@markdown ###Name and path to the final trained model:

trained_model_name = "SeptinDetection_Model1_ep50" #@param {type:"string"}

trained_model_path = project_path + "/Models" #@param {type:"string"}
#trained_model = model_path

#project_folder_name = 'CytoYOLOv8_RectLabel' #@param {type:"string"}
#result_folder_name = 'SemiSparse_modelS_ep200_ba8_'#@param {type:"string"}

#@markdown ### Choose between the pretrained YOLO detection models (n-seg, s-seg, m-seg, l-seg, x-seg):
YOLO_model_type= 'm-seg'#@param {type:"string"}
#@markdown ### Other parameters for training:
epochs =  100#@param {type:"number"}
batch_size =  4#@param {type:"number"}
initial_learning_rate = 0.01#@param {type:"number"}
patch_width = 200#@param {type:"number"}
patch_height = 200#@param {type:"number"}
imgsz = (patch_width,patch_height)

"""# Training → Step #4: Model Training

Finally, it's time for training (fine-tuning) the YOLOv8 on our data!
"""

from ultralytics import YOLO

optimizer = 'auto' # SGD, Adam, AdamW, NAdam, RAdam, RMSProp or auto
plots= True  # Generates and saves plots of training and validation metrics, as well as prediction examples
#model = YOLO('yolov8n.pt')  # load a pretrained YOLO detection model (n, s, m, l , x)
model_pt = 'yolov8'+YOLO_model_type+'.pt'
model = YOLO(model_pt)
#@markdown ###Path to the YAML file
yaml_address = '/content/Project_Septin/datasets/test-1/data.yaml'#@param {type:"string"}
model.train(data=yaml_address, epochs=epochs, batch=batch_size, lr0= initial_learning_rate, imgsz=imgsz, save=True, pretrained=True,optimizer=optimizer, plots = plots)  # train the model

"""# Prediction on Multiple Images
To perform predictions on multiple images, the user needs to provide the following inputs to the notebook:

- Path to the **.pt file**: Specify the path to the trained YOLO model file (e.g., /content/Project_Septin/datasets/runs/detect/train/weights/best.pt).
- Confidence threshold (**conf**): Define the confidence level for predictions (e.g., 0.25). Predictions with a confidence score below this threshold will be ignored.
- Folder containing test images: Provide the path to the folder where the test images are stored.

Once these inputs are provided, the notebook will process each image in the specified folder, apply the YOLO model for predictions, and output the results.

Note: The cell visualizes a single segmentation result. To access all the output segmentations, please navigate manually to the results folder.
"""

import os
import torch
import numpy as np
from PIL import Image
import matplotlib.pyplot as plt
from tqdm import tqdm
from ultralytics import YOLO  # Ensure YOLO is imported
# Specify your image dimensions, for example (200, 200)
image_shape = (patch_width, patch_height)

path_to_test_folder = '/content/Project_Septin/test'  # @param {type:"string"}
path_to_model = '/content/Project_Septin/datasets/runs/segment/train/weights/best.pt'  # @param {type:"string"}
path_to_results_folder = '/content/Project_Septin/results'  # @param {type:"string"}
resultsFolderName = trained_model_name
confidence = 0.2  # @param{type:"number"}
iou = 0.2  # @param{type:"number"}

path_to_centers = path_to_results_folder + '/' + resultsFolderName + '/Centers'
# Check if the output folder exists, if not, create it
if not os.path.exists(path_to_centers):
    os.makedirs(path_to_centers)

# Load YOLO model
model = YOLO(path_to_model)

# Function to draw centers on a binary image
def draw_centers_on_binary_image(boxes, image_shape):
    binary_image = np.zeros(image_shape, dtype=np.uint8)
    for box in boxes:
        x_min, y_min, x_max, y_max = box.xyxy[0]
        center_x = int((x_min + x_max) / 2)
        center_y = int((y_min + y_max) / 2)
        binary_image[center_y - 1:center_y + 2, center_x - 1:center_x + 2] = 1
    return binary_image

# Verify the folder path
if not os.path.isdir(path_to_test_folder):
    print("The specified folder does not exist.")
else:
    print('Processing test images...')
    for image_file in tqdm(os.listdir(path_to_test_folder), desc='Progress'):
        if image_file.lower().endswith(('.png', '.jpg', '.jpeg')):  # Check if the file is an image
            image_path = os.path.join(path_to_test_folder, image_file)

            # YOLO prediction
            results = model.predict(
                [image_path],
                conf=confidence,
                iou=iou,
                save=True,
                project=path_to_results_folder,
                name=resultsFolderName,
                exist_ok=True,
                show_conf=False,
                show_labels=False,
                save_crop=False,
                show_boxes=False,
                line_width=2
            )

            # Process the first result
            result = results[0]
            boxes = result.boxes  # Bounding box outputs

            # Create a binary image with centers marked
            binary_image = draw_centers_on_binary_image(boxes, image_shape)
            binary_image_pil = Image.fromarray(binary_image * 255)  # Multiply by 255 for white centers
            binary_image_pil.save(os.path.join(path_to_centers, f'centers_{image_file}.jpg'))

            # Load the original image and detection result for visualization
            original_image = Image.open(image_path)
            detection_image_path = os.path.join(path_to_results_folder, resultsFolderName, image_file)
            detection_image = Image.open(detection_image_path)

            # Display raw image and detection result side by side
            fig, axs = plt.subplots(1, 2, figsize=(12, 6))
            axs[0].imshow(original_image)
            axs[0].set_title("Original Image")
            axs[0].axis("off")

            axs[1].imshow(detection_image)
            axs[1].set_title("Detection Results")
            axs[1].axis("off")

            plt.tight_layout()
            plt.show()
            break  # Stop after displaying the first result

print('*****************************************************************************************************')
print('The prediction results are saved in ---> ', os.path.join(path_to_results_folder, resultsFolderName), '/')
print('The center points are saved in ---> ', path_to_centers, '/')